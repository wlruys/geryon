profiles:
  local_dev:
    env_script: ./env/bootstrap.example.sh
    env_setup_cmds:
      - export OMP_NUM_THREADS=1
      - export MKL_NUM_THREADS=1
    env:
      GERYON_SITE: local_dev

  local_throughput:
    env_script: ./env/bootstrap.example.sh
    env_setup_cmds:
      - export OMP_NUM_THREADS=8
      - export MKL_NUM_THREADS=8
    env:
      GERYON_SITE: local_throughput
    defaults:
      run_local:
        executor: process
        max_concurrent_tasks: 4

  local_resiliency:
    env_script: ./env/bootstrap.example.sh
    env:
      GERYON_SITE: local_resiliency
    defaults:
      run_local:
        executor: process
        max_concurrent_tasks: 4
        cores_per_task: 1
        command_timeout_sec: 2
        max_retries: 1
        retry_on_status: [failed, terminated]
        max_failures: 3
        resume: true
        progress: true

  local_fail_fast:
    env_script: ./env/bootstrap.example.sh
    env:
      GERYON_SITE: local_fail_fast
    defaults:
      run_local:
        executor: process
        max_concurrent_tasks: 2
        max_failures: 2
        resume: true

  slurm_cpu_debug:
    partition: debug
    time_min: 30
    cpus_per_task: 4
    mem_gb: 16
    gpus_per_node: 0
    job_name: geryon_cpu_debug
    env_script: ./env/bootstrap.example.sh
    slurm_additional_parameters:
      account: my_project
      qos: debug
    env:
      GERYON_SITE: slurm_cpu_debug
    defaults:
      run_slurm:
        executor: process
        max_concurrent_tasks: 4
        cores_per_task: 1
        batches_per_task: 1
        query_status: true

  slurm_gpu_debug:
    partition: gpu
    time_min: 60
    cpus_per_task: 8
    mem_gb: 64
    gpus_per_node: 1
    job_name: geryon_gpu_debug
    env_script: ./env/bootstrap.example.sh
    slurm_setup_cmds:
      - module purge
      - module load cuda/12.2
    slurm_additional_parameters:
      account: my_project
      qos: debug
    env:
      GERYON_SITE: slurm_gpu_debug
    defaults:
      run_slurm:
        executor: tmux
        max_concurrent_tasks: 2
        cores_per_task: 4
        batches_per_task: 2
        resume: true
        query_status: true
